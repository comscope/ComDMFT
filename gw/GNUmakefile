include ../arch.mk
# compfl = -debug -g -CB -check bounds -traceback -check uninit -fp-model precise
# compfl = -O3
#i&&&&&&&&&&&&&&&&&&&&&&&&&&&&        UNIX MPICH MPI       &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

comp = $(PF90) $(FPPFLAGS) -DMPI -c $(compfl)
link = $(PF90)  $(compfl)
LIB =  $(LAPACK_LIB) 

PROG = rspflapw.exe


#&&&&&&&&&&&&&&&&&&&& default settings &&&&&&&&&&&&&&&&&&&&

.SUFFIXES: .mod .F .o 

#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
o_files = \
write_uca_files.o \
a_cont_coeff.o  \
a_cont_ferm.o  \
a_cont_weights.o  \
add_cor.o  \
add_to_output_w.o  \
add_vxc.o  \
afteread.o  \
angle.o  \
asympt_sums_nu.o  \
asympt_sums_omega.o  \
atom.o  \
atom_mod.o  \
qsort_mod.o \
atscfp.o  \
aux_sums.o  \
bandener.o  \
bands.o  \
bands_gnuplot.o  \
bands_near_ef.o  \
bands_qp.o  \
bands_sig_0.o  \
beging.o  \
bessc.o  \
b_me.o  \
bld_sh_trans.o \
bose_red.o  \
boson_cheb_coeff_nu.o  \
boson_interp_nu.o  \
boson_interp_nu_v_c1.o  \
boson_interp_nu_v_c.o  \
boson_interp_nu_v.o  \
boson_neg_tau.o  \
boson_pack_tau.o  \
boson_unpack_tau.o  \
boson_unpack_tau_par.o  \
bos_sums.o  \
bravay.o  \
ccutup.o  \
cft.o  \
check_band_states.o  \
check_b.o  \
check_hermit.o  \
check_pv_sym.o  \
check_w_sym.o  \
classes_k.o  \
clebsch.o  \
cnsbet.o  \
compare_vec_mod.o  \
conjgrad.o  \
conv_hh.o  \
core_all.o  \
core_atom_0.o  \
core_atom.o  \
cor_new.o  \
coulener.o  \
coul_int.o  \
cshear.o  \
d_cheb_dx.o  \
dcheb_recurr.o  \
debugger.o \
dft_loop.o  \
dif.o  \
divide_bz.o  \
dlmtor.o  \
dm.o  \
dm_j.o  \
dos.o  \
dqdall.o  \
dro1sub.o  \
dsinx_dx.o  \
dsyevx_1.o  \
dsytrd_1.o  \
e1_q0_fit.o  \
efins.o  \
eiglin.o  \
eig_val_gener_solver.o  \
eig_val_gener_solver_r.o  \
eig_val_solver.o  \
eig_val_solver_r.o  \
equal.o  \
equiv_atom.o  \
erfxx.o  \
error_alloc.o \
error_dealloc.o \
etot_c_from_pw.o  \
etot_gw_0.o  \
etot_gw_1.o  \
etot_gw_2.o  \
etot_mod.o  \
etot_x_from_pw.o  \
exchcorr.o  \
exchener.o  \
e_x_cor.o  \
excvxc2d.o  \
f100.o  \
f102.o  \
fac2.o  \
ferm_cheb_coeff_omega.o  \
fermi_dirac.o  \
ferm_interp_omega.o  \
fermi_omega.o  \
ferm_pack_omega.o  \
ferm_pack_tau.o  \
ferm_rs_from_ks.o  \
ferm_rs_from_ks_ii.o  \
ferm_rs_from_ks_mi.o  \
ferm_sums.o  \
ferm_unpack_omega.o  \
ferm_unpack_tau.o  \
f_ex_new.o  \
fft3.o  \
fgtlind.o  \
fi0_full.o  \
files_mod.o \
fint.o  \
fit_zero.o  \
flapw_1.o  \
flapw_driver.o \
f_om_nu_maz.o  \
for_nu_interpolation.o  \
for_omega_interpolation.o  \
fourier.o  \
fractional2cartesian.o  \
freeatom.o  \
free_energy_c.o  \
free_energy_x.o  \
from_nu_to_tau.o  \
from_omega_to_tau.o  \
from_tau_r_to_tau_herm.o  \
from_tau_to_nu.o  \
from_tau_to_omega.o  \
g0_sig_g_omega.o  \
gbs_number.o  \
g_c_delta_omega.o  \
g_c_omega_atom.o  \
g_c_omega.o  \
g_c_pack_omega.o  \
get_bz.o  \
get_cfgt.o  \
get_fi0_gw.o  \
getind.o  \
get_indgb.o  \
get_indk1.o  \
get_indk.o  \
get_indk_sum.o  \
get_k.o  \
getlimj.o  \
getmaxb.o  \
getmts.o  \
get_nre.o  \
get_pc.o  \
getplw.o  \
get_pv.o  \
getrbs.o  \
get_r.o  \
get_rr.o  \
getsuml.o  \
get_tau.o  \
get_t.o  \
get_tmm.o  \
gety.o  \
g_inside_cutoff.o  \
g_k_g_r1.o  \
g_loc_degen.o  \
g_mt_from_g_full.o  \
goto_end.o  \
g_pair_print_prepare.o  \
g_qp_omega.o  \
g_qp_tau.o  \
green0_boson_nu.o  \
green0_boson_tau.o  \
green_0.o  \
green0.o  \
green_34_omega.o  \
green_34_tau.o  \
group.o  \
group_table.o  \
g_rr_r_r1_star.o  \
g_rs_from_ks_mi.o  \
g_rs_from_ks_mm.o  \
gtbvec.o  \
gw_loop.o  \
gx_k_g_r1.o  \
g_x_omega.o  \
gx_rs_from_ks_mi.o  \
gx_rs_from_ks_mm.o  \
g_x_tau.o  \
hankel.o  \
heg_e1_small_q.o \
h_magn_external_mt.o  \
ind_block.o  \
indgb_e.o  \
inf_qnt.o  \
inhomo.o  \
init.o  \
init_vh.o  \
inp_gga.o  \
inp_lda.o  \
inp_mod.o \
input_mod.o \
int1_xn_exp_ax.o  \
intalt.o  \
integral_band_pw_band.o  \
integral_band_pw_band_mt1.o  \
integral_band_pw_band_mt.o  \
integral_band_pw_band_vrt.o  \
integral_matrix_simpson.o  \
integral_m_j.o  \
integral_pbint_pw.o  \
integral_pbmt_pw_0.o  \
integral_pbmt_pw.o  \
integral_pw_i.o  \
integral_pw_j.o  \
integral_pw_k.o  \
integr_tau2.o  \
interp_array_opt.o  \
interp_bos_even_tau.o  \
interp_bos_even_tau_prepare.o  \
interp_ferm_tau.o  \
interp_ferm_tau_prepare.o  \
interp_g_omega_c.o  \
interp_g_omega.o  \
interp_g_omega_sq.o  \
interp_g_tau_bnd.o  \
interp_inside.o  \
interp_w_nu_rsq.o  \
interp_w_nu_shell.o  \
interp_w_nu_sq.o  \
interp_w_nu_v.o  \
int_me.o  \
int_tau_sigc_gc.o  \
int_tau_sigc_gx.o  \
invers_z.o  \
k_for_band_plot.o  \
k_sym_intact.o  \
lda_dmft_mod.o \
lda_dmft_charge_density.o \
lda_k_point.o  \
legendre.o  \
legpol.o  \
lgen.o  \
lget.o  \
lindhardt_stat.o  \
local_orb.o  \
mag_mom.o  \
manager_mod.o  \
matchav.o  \
matching.o  \
mathpaw.o  \
matrix_norms.o  \
matr_k_reducible.o  \
memory1_solid.o  \
memory_atom.o \
memory_close.o  \
memory_flapw.o  \
memory_solid.o  \
me_orb_real.o  \
mesh_nu_d.o  \
mesh_nu.o  \
mesh_omega_d.o  \
mesh_omega.o  \
mesh_tau_cheb.o  \
mixer_gw.o  \
mixro1.o  \
mix_up_down.o  \
mkl_dfti.o  \
mklegw.o  \
mq_prepare.o  \
mt_me.o  \
mxmymz.o  \
nasos.o  \
neighbor_atm.o  \
neighbors_atoms.o  \
neighbors_k_all.o  \
norma_wf.o  \
nu_fitting_2.o  \
nu_fitting.o  \
num_bz0_ijk.o  \
occ_number.o  \
optimize_mod.o  \
orb_rel.o  \
orb_tot.o  \
ordering_all.o  \
ordering.o  \
output_boson_q_nu.o  \
output_dos.o \
output_eigen_states.o  \
output_gc_band_omega.o  \
output_gc_band_tau.o  \
output_gx_band_tau.o  \
output_pol_tau_q.o  \
output_ro_v.o  \
output_sigc_band_tau.o  \
output_sigma_ac.o  \
output_sigma_band.o  \
output_static_band.o  \
output_sym_k_orb_char.o  \
output_vh_sigx_band.o  \
output_w.o  \
output_z_factor.o  \
overlap_lapw.o  \
overl_bnd_spin.o  \
pack_hermit.o  \
pade_fermion_chain.o  \
pade_fermion_chain_out.o  \
parallel_mod.o  \
parsbl.o  \
pb_original_integral.o  \
p_ii_solid.o  \
p_im_q_from_r.o  \
p_im_r.o  \
pja.o  \
plegn.o  \
plot_bands_lapw.o  \
plwovi.o  \
plwrho.o  \
p_mm_q_from_r.o  \
p_mm_r.o  \
pnp.o  \
poiss1.o  \
pol_0_spin_spin.o  \
prd1.o  \
prd2.o  \
prd.o  \
printi.o  \
print_matrix.o  \
prnatom.o  \
prod_b1.o  \
prod_b2.o  \
prod_bas.o  \
properties.o  \
p_r_tau_solid.o  \
psi_function_to_real_mesh.o  \
psi_psi_m.o  \
pw_from_pb.o  \
qft.o  \
qp_green.o  \
rad_dif.o  \
rad_eq0.o  \
rad_eq1.o  \
rad_eq2.o  \
rad_eq3.o  \
rad_eq.o  \
rad_eqs.o  \
rad_hf_check.o  \
rad_inscribed_sphere.o  \
radli.o  \
radmsh.o  \
radsch_b.o  \
radsch.o  \
ranw.o  \
rbs_number.o  \
read_kpath.o \
read_restart_files.o \
readini.o  \
reduc.o  \
renr_val.o  \
r_mesh_checking.o  \
rofull_atom.o  \
rofull.o  \
ro_int_g.o  \
rostart.o  \
rotate11.o  \
rotate.o  \
rotate_opt.o  \
rot_mag.o  \
ro_val.o  \
ro_v_cartesian_0.o  \
r_pair_a_sym.o  \
rr_degeneracy.o  \
rr_inside_sphere_0.o  \
rr_mesh_coarse.o  \
sbzmesh.o  \
scf_0.o  \
scg.o  \
scgr.o  \
sckg2.o  \
screened_w.o  \
search_mu_0.o  \
search_mu_brent.o  \
search_mu.o  \
self_energy_1.o  \
self_energy_dft_basis.o  \
self_energy.o  \
set_adm.o  \
set_control.o  \
setdiag.o  \
seteny.o  \
setfgtl.o  \
set_g00.o  \
set_g.o  \
set_g_tau_0.o  \
set_h0.o  \
setk2.o  \
set_pairs.o  \
setpw_gw1.o  \
setpw_gw.o  \
setrel.o  \
setsites.o  \
set_stars.o  \
setwmt.o  \
sgaunt.o  \
sgroup.o  \
sigc_ii_solid.o  \
sigc_im_k_from_r.o  \
sigc_im_r.o  \
sigc_mm_k_from_r.o  \
sigc_mm_r.o  \
sigc_r_tau_solid.o  \
sigma_0_z_ren.o  \
sigma_int_int_fin.o  \
sigma_loc_fin.o  \
sigma_mt_int_fin.o  \
sigma_mt_mt_fin.o  \
sigma_prelim.o  \
sigma_x_final.o  \
sigma_x_int_int.o  \
sigma_x_loc.o  \
sigma_x_mt_int.o  \
sigma_x_mt_mt.o  \
sigma_x_rs.o  \
sig_omega0_g1.o  \
sig_omega0_solid.o  \
sig_omega_solid.o  \
sigx_at_rr.o \
sigx_ii_k_from_r.o  \
sigx_im_k_from_r.o  \
sigx_im_r.o  \
sigx_im_r_rel.o  \
sigx_k_solid.o  \
sigx_mm_k_from_r.o  \
sigx_mm_r.o  \
simpson_hmg.o  \
sin_cos_integral.o  \
sin_integral.o  \
sitegen.o  \
sitegen_mod.o  \
size_shift_par.o  \
size_shift_par_load.o \
sltrt.o  \
smultro.o  \
solid.o  \
solid_mod.o  \
solid_scf.o  \
s_overlap.o  \
s_overlap_m_b.o  \
s_overlap_pb_delta.o  \
spgcop.o  \
spgeql.o  \
spgprd.o  \
sphharm.o  \
spin_orbit_core.o  \
spin_orbit_rel.o  \
spline.o  \
spline_hmg.o  \
spline_inhmg.o  \
spline_ints_basic.o  \
spline_start_c.o  \
spline_start.o  \
split_magn.o  \
sp_rel.o  \
start_par_mb.o  \
start_par_solid.o  \
step_descend.o  \
sum_b0b0.o  \
sum_band_orb_char.o  \
sum_fb0.o  \
sum_ff.o  \
sumi_gw.o  \
sum_mats_p_w_loc.o  \
sum_maz_p_w.o  \
sum_maz_sig_gc.o  \
sum_maz_sig_gx.o  \
sum_up_weights.o  \
sym_a_0.o  \
sym_a_1.o  \
sym_boson_rs.o  \
sym_bos_tt.o  \
sym_bos_tt_r.o  \
sym_eps_inv.o  \
sym_g_iat_jat_rr.o  \
sym_g_iat_r1_rr.o  \
symg_loc.o  \
sym_ii_rr_boson.o  \
sym_left.o  \
sym_left_tt.o  \
symlmm.o  \
sym_me.o  \
symmetrization_z.o  \
sym_mi_rr_boson.o  \
sym_mm_loc_boson.o  \
sym_mm_rr_boson.o  \
sym_mp_mt.o  \
sym_m_p_s.o  \
sym_pro.o  \
sym_pro_w.o  \
sym_pro_w_side.o  \
sym_r_r1_q_boson.o  \
symscal.o  \
sym_sig_r_from_nonsym.o  \
sym_sig_r_from_nonsym_ii.o  \
sym_sig_rs.o  \
sym_sig_rs_rel.o  \
sym_tt_int.o  \
sym_tt_mt.o  \
sym_val_left.o  \
symvec.o  \
sym_vmi_left.o  \
sym_v_mm_rs.o  \
sym_w.o  \
sym_w_ii.o  \
sym_w_im.o  \
sym_w_left.o  \
sym_w_mi.o  \
sym_w_mt.o  \
sym_w_mt_side.o  \
sym_z_0.o  \
sym_z.o  \
tau_fitting_2.o  \
tau_fitting_3.o  \
tau_fitting.o  \
tau_frequency_meshes.o  \
tau_interp_even_coef.o  \
tau_interp_odd_coef.o  \
tcgstb.o  \
tetrahedron.o  \
tos_c.o  \
tos_c_solid.o  \
tos.o  \
tos_lda.o  \
tos_x_solid.o  \
tot_rel.o  \
transf_bos_from_tau1.o  \
transf_bos_from_tau.o  \
transf_ferm_from_tau1.o  \
transf_ferm_from_tau.o  \
transf_tau_from_nu_cheb.o  \
transf_tau_from_nu_d.o  \
transf_tau_from_nu.o  \
transf_tau_from_omega_cheb.o  \
transf_tau_from_omega.o  \
trans_pb_pw.o  \
trapezoidal_integral.o  \
trig_simpson.o  \
t_t1_x.o  \
ubi_sumus.o  \
units_mod.o  \
unport.o  \
upor.o  \
vandermond.o  \
var_int.o  \
var_int_right.o  \
v_bloch.o  \
vcoulat.o  \
vcoul.o  \
v_coul_full.o  \
v_coul_full_ii.o  \
v_coul_full_mi.o  \
v_coul_full_mt.o  \
v_coulomb.o  \
vexchat.o  \
vexch.o  \
vgensp.o  \
vgensph.o  \
v_im_r_from_k.o  \
v_me.o  \
v_mm_from_q.o  \
v_q_g_r1.o  \
vslli.o  \
vxint.o  \
warped.o  \
warp.o  \
wign.o  \
wign_j.o  \
w_mm.o  \
w_q_g_r1.o  \
w_red_ii.o \
w_red_mi.o \
write_restart_files.o \
writero.o  \
w_rr_r_r1_star.o  \
ws_k_nu_solid_0.o  \
ws_k_nu_solid.o  \
w_tau_from_compact_form_r.o  \
x_cheb_from_something.o \
x_limits_3_site.o  \
xorder.o  \
y_limits_3_site.o  \
zerov.o  \
z_factor_from_sigma.o  \
zheevx.o  \
zhetrd.o  \
z_limits_3_site.o  \
zone0_cart.o  \
zone1_cart.o  \
zone1_number.o  \
zx_hf.o  \
write_wan_files.o  \
zy_hf.o \


mod_files = \
 atom_mod.mod \
 etot_mod.mod \
 files_mod.mod \
 input_mod.mod \
 inp_mod.mod \
 lda_dmft_mod.mod \
 manager_mod.mod \
 mkl_dfti.mod \
 optimize_mod.mod \
 parallel_mod.mod \
 qsort_mod.mod \
 sitegen_mod.mod \
 solid_mod.mod \
 units_mod.mod

ifdef USE_HDF5
  o_files += write_wan_files_hdf5.o
  o_files += write_uca_files_hdf5.o
  o_files += hdf5io_mod.o
  mod_files += hdf5io_mod.mod
endif

all: $(PROG)

mods: $(mod_files)

clean:
	rm -f *.o *.mod rspflapw.exe

.F.o:
	$(comp) $*.F

$(PROG) : $(mod_files) $(o_files)
	$(link) $(o_files) -o $(PROG) $(LIB)
	cp $(PROG) ../bin
.o.mod:
	echo $<

.c.o:
	mpicc -c $*.c

test_hdf5.exe: hdf5io_mod.F
	$(link) -DTEST_HDF5 hdf5io_mod.F $(LIB) -o test_hdf5.exe
